<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Ege Güney Kıymaç">
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>BaseVarModel - MacroSim Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" disabled>
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="https://unpkg.com/katex@0/dist/katex.min.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">MacroSim Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Class Documentations</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../SeriesAccessor/" class="dropdown-item">SeriesAccessor</a>
</li>
                                    
<li>
    <a href="../EqSearch/" class="dropdown-item">EqSearch</a>
</li>
                                    
<li>
    <a href="../GrowthPatternDetector/" class="dropdown-item">GrowthPatternDetector</a>
</li>
                                    
<li>
    <a href="../BaseVarSelector/" class="dropdown-item">BaseVarSelector</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">BaseVarModel</a>
</li>
                                    
<li>
    <a href="../SimEngine/" class="dropdown-item">SimEngine</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">About</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../LICENSE" class="dropdown-item">License</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../BaseVarSelector/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../SimEngine/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="true">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#basevarmodel" class="nav-link">BaseVarModel</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#example-usage" class="nav-link">Example Usage</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#methods" class="nav-link">Methods</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="basevarmodel">BaseVarModel</h1>
<p>This class is responsible for modelling the variables selected as the base components of a feedback loop. <code>BaseVarModel</code>
is a class that extends <code>BaseVarSelector</code> and automates the process of base variable selection prior to modelling. The
class attempts to create an accurate symbolic regression (SR) model with lagged features of base variables and evaluates 
it against a random forest (RF) model.</p>
<p>The processing pipeline takes steps for aggressive outlier elimination and model distillation in the following structure:</p>
<ol>
<li>Use <code>sklearn.neighbors.LocalOutlierFactor</code> to remove local outliers from the data</li>
<li>Check for seasonality in the filtered data through the use of autocorrelation analysis (ACF)</li>
<li>Fit a <code>sklearn.ensemble.RandomForestRegressor</code> to the filtered data, using lagged features.</li>
<li>Distill the data by replacing true y values by RF predictions. (further smooths out the noise)</li>
<li>Initiate a <code>PySRRegressor</code> instance and enable or disable cyclical trigonometric functions based on the seasonality
check at step 2 (trig enabled if data shows seasonality)</li>
<li>Fit the SR model to the distilled data</li>
<li>Compare <span class="arithmatex">\(MSE_{SR}\)</span> and <span class="arithmatex">\(MSE_{RF}\)</span>, opt for using RF as the base model if SR introduces a significant increase to MSE</li>
</ol>
<p>Following this pipeline, a generalized symbolic expression <span class="arithmatex">\(f(x_{t}, \dots, x_{t-n}) = y_t\)</span> is derived. (provided the 
equation produces reasonable MSE) Model selection at the final step is performed such that:</p>
<div class="arithmatex">\[
E_{MSE} = \frac{MSE_{SR}}{MSE_{RF}} -1
\]</div>
<div class="arithmatex">\[
\text{and}
\]</div>
<div class="arithmatex">\[
Model = \begin{cases}
SR &amp; \text{if  } E_{MSE} &lt; 0.05 \\
RF &amp; \text{if  } E_{MSE} \geq 0.05
\end{cases}
\]</div>
<h2 id="example-usage">Example Usage</h2>
<pre><code class="language-python">from macrosim import BaseVarModel
import pandas as pd

df = pd.DataFrame(...)
bvm = BaseVarModel(df=df)

base: pd.DataFrame = bvm.get_base_candidates()

models = {}
for base_var in base.columns:
    bvm.symbolic_model(base[base_var],  # Run symbolic search with kwargs to set model params
                       maxsize=24,
                       niterations=200,
                       constraints= {
                           'atan': 1,  # Complexity of x for arctan(x)
                           '^': (-1, 3)  # Complexity of (x, y) for x^y. -1 = No constraint.
                       })  

    print(bvm.sr.get_best())  # Check descriptives of the best SR expression regardless of selected model 

    models[base_var] = bvm.model_select()  # Returns RF or SR based on MSE criteria
</code></pre>
<h2 id="methods">Methods</h2>
<h3 id="basevarmodelget_best_candidates"><code>BaseVarModel.get_best_candidates</code></h3>
<p>Run Granger Causality tests implemented in <code>BaseVarSelector</code> to determine the most causal variables.</p>
<p><strong>Params:</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Returns:</strong></p>
<ul>
<li><code>pd.DataFrame</code>: Dataframe of the 2 most causal variables. (Will be parametrized to top <span class="arithmatex">\(n\)</span> variables in the future)</li>
</ul>
<h3 id="basevarmodelsymbolic_model"><code>BaseVarModel.symbolic_model</code></h3>
<p>Fit an SR instance with the given base variable.</p>
<p><strong>Params:</strong></p>
<ul>
<li>
<p><code>candidate: pd.Series</code>: Data of chosen base variable candidate</p>
</li>
<li>
<p><code>**kwargs</code>: Model parameters accessible through keyword arguments (refer to <a href="https://astroautomata.com/PySR/api/" target="_blank">PySR Docs</a> for further 
explanation of each kwarg)</p>
</li>
<li>
<p><code>model_selection: Literal['best', 'score', 'accuracy'] = 'accuracy'</code>: Model selection criterion</p>
</li>
<li><code>niterations: int = 300</code>: Iterations per cycle</li>
<li><code>maxsize: int = 32</code>: Maximum size of the symbolic expression</li>
<li><code>constraints: dict[str, int | tuple] = {}</code>: Extra constraints to the complexity of binary and unary operators</li>
<li><code>elementwise_loss: str = 'L2DistLoss()'</code>: Loss function defined in julia syntax or one of the predefined loss functions
  available <a href="https://astroautomata.com/PySR/api/#the-objective" target="_blank">here</a>.</li>
<li><code>progress: bool = False</code>: Enable progress bar (Does not work for ipython environments)</li>
<li><code>temp_equation_file: bool = True</code>: Record search results to a csv if False.</li>
<li><code>deterministic: bool = True</code>: Non-deterministic search if False, (parallelism='serial' is 
  required for deterministic behavior)</li>
<li><code>parallelism: Literal['serial', 'multithreading', 'multiprocessing'] = 'serial</code>: Method of parallelization</li>
<li><code>random_state: int = 0</code>: Randomness seed</li>
<li><code>grid_search: False</code>: A grid search is performed at RF fit if True (gs_params should be passed for the grid 
  search to run)</li>
<li><code>gs_params: dict[str, List[Any] = {}</code>: Parameter grid for the RF grid search</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../javascripts/katex.js"></script>
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
